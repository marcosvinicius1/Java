/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package br.com.atmatech.sac.view;

import br.com.atmatech.sac.beans.ListPerUsuarioBeans;
import br.com.atmatech.sac.beans.UsuarioBeans;
import br.com.atmatech.sac.controller.NivelAcesso;
import br.com.atmatech.sac.dao.PerusuarioDao;
import br.com.atmatech.sac.dao.UsuarioDao;
import java.awt.event.MouseEvent;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.MutableTreeNode;
import javax.swing.tree.TreeNode;

/**
 *
 * @author MARCOS
 */
public class ViewNivel extends javax.swing.JPanel {

    /**
     * Creates new form ViewModulo
     */
    Object ativo;
    List<ListPerUsuarioBeans> lpub = new ArrayList<>();
    List<UsuarioBeans> lub = new ArrayList<>();

    public ViewNivel() {
        initComponents();
        jtidusuario.setVisible(false);
        jtnome.setVisible(false);
        getUsuarios();
        permissaoUsuario();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPMnivel = new javax.swing.JPopupMenu();
        jMexpandir = new javax.swing.JMenuItem();
        jMmarcatodos = new javax.swing.JMenuItem();
        jPanel1 = new javax.swing.JPanel();
        jBsalvar = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTnivel = new javax.swing.JTree();
        jtnome = new javax.swing.JTextField();
        jBcarregar = new javax.swing.JButton();
        JCusuario = new javax.swing.JComboBox();
        jtidusuario = new javax.swing.JTextField();

        jMexpandir.setText("Expandir");
        jMexpandir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMexpandirActionPerformed(evt);
            }
        });
        jPMnivel.add(jMexpandir);

        jMmarcatodos.setText("Marcar Todos");
        jMmarcatodos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMmarcatodosActionPerformed(evt);
            }
        });
        jPMnivel.add(jMmarcatodos);

        setPreferredSize(new java.awt.Dimension(799, 613));

        jPanel1.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jPanel1.setMinimumSize(new java.awt.Dimension(127, 69));
        jPanel1.setName(""); // NOI18N

        jBsalvar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/br/com/atmatech/sac/icon/Knob Valid Blue.png"))); // NOI18N
        jBsalvar.setText("Salvar");
        jBsalvar.setEnabled(false);
        jBsalvar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBsalvarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jBsalvar)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jBsalvar)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel2.setPreferredSize(new java.awt.Dimension(779, 294));

        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("Nivel de Acesso");
        javax.swing.tree.DefaultMutableTreeNode treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewAtendimento");
        javax.swing.tree.DefaultMutableTreeNode treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        javax.swing.tree.DefaultMutableTreeNode treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("salvar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewListaAtendimento");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewModulo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewNivel");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewPessoa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewUsuario");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewVeiculo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewFinanceiro");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewEmpresa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewRelatorio");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("criar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        jTnivel.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));
        jTnivel.setAutoscrolls(true);
        jTnivel.setEnabled(false);
        jTnivel.setShowsRootHandles(true);
        jTnivel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTnivelMouseClicked(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jTnivelMousePressed(evt);
            }
        });
        jScrollPane1.setViewportView(jTnivel);

        jtnome.setEnabled(false);

        jBcarregar.setText("...");
        jBcarregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBcarregarActionPerformed(evt);
            }
        });

        JCusuario.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                JCusuarioFocusLost(evt);
            }
        });

        jtidusuario.setEnabled(false);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 334, Short.MAX_VALUE)
                    .addComponent(JCusuario, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jBcarregar, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(69, 69, 69)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jtidusuario, javax.swing.GroupLayout.DEFAULT_SIZE, 68, Short.MAX_VALUE)
                    .addComponent(jtnome))
                .addContainerGap(263, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jtnome, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBcarregar)
                    .addComponent(JCusuario, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(14, 14, 14)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 443, Short.MAX_VALUE)
                        .addContainerGap())
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jtidusuario, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, 511, Short.MAX_VALUE)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jBsalvarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBsalvarActionPerformed

        if (jtnome.getText().equals(JCusuario.getSelectedItem())) {
            lpub.clear();
            TreeNode tn = (TreeNode) jTnivel.getModel().getRoot();
            //atualiza lista de permissoes do usuario
            nivel(tn);
            setNivel(lpub);
            JOptionPane.showMessageDialog(this, "Registro Alterado com Sucesso", "Nivel Acesso", JOptionPane.INFORMATION_MESSAGE);
        } else {
            JOptionPane.showMessageDialog(this, "Carregue as Permissões Antes de Salvar", "Nivel Acesso", JOptionPane.INFORMATION_MESSAGE);
        }


    }//GEN-LAST:event_jBsalvarActionPerformed

    public void nivel(TreeNode theNode) {
        ativo = theNode;
//        System.out.println("1-- " + theNode.getParent() + "" + theNode);
        for (Enumeration theChildren = theNode.children(); theChildren.hasMoreElements();) {
            nivel((TreeNode) theChildren.nextElement());
            if (theNode.getParent() != null) {
                if (!theNode.getParent().toString().contains("Nivel de Acesso")) {
                    ListPerUsuarioBeans pub = new ListPerUsuarioBeans();
                    pub.setIdusuario(Integer.valueOf(jtidusuario.getText()));
                    pub.setView(theNode.getParent().toString());
                    pub.setAcao(theNode.toString());
                    pub.setAtivo(ativo.toString());
                    lpub.add(pub);
                }
            }
        }
    }

    private void jTnivelMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTnivelMousePressed
        // TODO add your handling code here:
        if (evt.getClickCount() == 2) {
            DefaultTreeModel model = (DefaultTreeModel) jTnivel.getModel();
            DefaultMutableTreeNode selectNode = (DefaultMutableTreeNode) jTnivel.getLastSelectedPathComponent();
            if (selectNode != null) {
                if (selectNode.getUserObject().equals("sim")) {
                    DefaultMutableTreeNode newObject = new DefaultMutableTreeNode("nao");
                    model.insertNodeInto(newObject, (MutableTreeNode) selectNode.getParent(), selectNode.getChildCount());
                    model.removeNodeFromParent(selectNode);
                }
                if (selectNode.getUserObject().equals("nao")) {
                    DefaultMutableTreeNode newObject = new DefaultMutableTreeNode("sim");
                    model.insertNodeInto(newObject, (MutableTreeNode) selectNode.getParent(), selectNode.getChildCount());
                    model.removeNodeFromParent(selectNode);
                }
            }
        }
    }//GEN-LAST:event_jTnivelMousePressed

    private void jBcarregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBcarregarActionPerformed
        // TODO add your handling code here: 
        carregarNivel();
    }//GEN-LAST:event_jBcarregarActionPerformed

    private void JCusuarioFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_JCusuarioFocusLost
        // TODO add your handling code here:
        if (!JCusuario.getSelectedItem().toString().equals(jtnome.getText())) {
            desativaView();
        }
    }//GEN-LAST:event_JCusuarioFocusLost

    private void jTnivelMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTnivelMouseClicked
        // TODO add your handling code here:
        if (((evt.getModifiers() & MouseEvent.BUTTON3_MASK) != 0) && (!jtidusuario.getText().equals(""))) {
            jPMnivel.show(jTnivel, evt.getX(), evt.getY());
        }
    }//GEN-LAST:event_jTnivelMouseClicked

    private void jMexpandirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMexpandirActionPerformed
        // TODO add your handling code here:
        for (int i = 0; i < jTnivel.getRowCount(); i++) {
            jTnivel.expandRow(i);
        }
    }//GEN-LAST:event_jMexpandirActionPerformed

    private void jMmarcatodosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMmarcatodosActionPerformed
        // TODO add your handling code here:
        marcaTodos();
    }//GEN-LAST:event_jMmarcatodosActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox JCusuario;
    private javax.swing.JButton jBcarregar;
    private javax.swing.JButton jBsalvar;
    private javax.swing.JMenuItem jMexpandir;
    private javax.swing.JMenuItem jMmarcatodos;
    private javax.swing.JPopupMenu jPMnivel;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTree jTnivel;
    private javax.swing.JTextField jtidusuario;
    private javax.swing.JTextField jtnome;
    // End of variables declaration//GEN-END:variables

    private void setNivel(List<ListPerUsuarioBeans> lpub) {
        try {
            new PerusuarioDao().deletePerusuario(Integer.valueOf(jtidusuario.getText()));
            new PerusuarioDao().setPerusuario(lpub);
            desativaView();
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(null, "Erro ao Salvar Permissões\n" + ex);
        }

    }

    private void getUsuarios() {
        lub = new UsuarioDao().getUsuario();
        JCusuario.removeAllItems();
        for (UsuarioBeans ub : lub) {
            JCusuario.addItem(ub.getNome());
        }
    }

    private void carregarNivel() {
        for (int i = 0; i < lub.size(); i++) {
            if (JCusuario.getSelectedIndex() == i) {
                getNivel(lub.get(i).getIdusuario());
                jtidusuario.setText(lub.get(i).getIdusuario().toString());
            }
        }
        jtnome.setText(JCusuario.getSelectedItem().toString());
        ativaView();
    }

    private void getNivel(Integer idusuario) {
        List<ListPerUsuarioBeans> lpub = new ArrayList<>();
        lpub = new PerusuarioDao().getPerusuario(idusuario);
        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("Nivel de Acesso");

        javax.swing.tree.DefaultMutableTreeNode treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewAtendimento");
        javax.swing.tree.DefaultMutableTreeNode treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        javax.swing.tree.DefaultMutableTreeNode treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewAtendimento", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);

        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("salvar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewAtendimento", "salvar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewAtendimento", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewListaAtendimento");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewListaAtendimento", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewListaAtendimento", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewListaAtendimento", "cadastrar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewModulo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewModulo", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewModulo", "alterar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewModulo", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewModulo", "cadastrar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewNivel");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewNivel", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewNivel", "alterar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewPessoa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewPessoa", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewPessoa", "alterar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewPessoa", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewPessoa", "cadastrar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewUsuario");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewUsuario", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewUsuario", "alterar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewUsuario", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewUsuario", "cadastrar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewVeiculo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewVeiculo", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewVeiculo", "alterar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewVeiculo", "excluir"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewVeiculo", "cadastrar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewFinanceiro");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewFinanceiro", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewEmpresa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewEmpresa", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewRelatorio");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewRelatorio", "acessar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("criar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode(buscaPermissao(lpub, "ViewRelatorio", "criar"));
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        jTnivel.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));

    }

    private Object buscaPermissao(List<ListPerUsuarioBeans> lpub, String view, String acessar) {
        for (ListPerUsuarioBeans lpub1 : lpub) {
            if (lpub1.getView().equals(view)) {
                if (lpub1.getAcao().equals(acessar)) {
                    return lpub1.getAtivo();
                }
            }
        }
        return "nao";
    }

    private void marcaTodos() {
        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("Nivel de Acesso");

        javax.swing.tree.DefaultMutableTreeNode treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewAtendimento");
        javax.swing.tree.DefaultMutableTreeNode treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        javax.swing.tree.DefaultMutableTreeNode treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("salvar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewListaAtendimento");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewModulo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewNivel");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewPessoa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewUsuario");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);
        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewVeiculo");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("alterar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("excluir");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("cadastrar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewFinanceiro");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewEmpresa");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode1.add(treeNode2);

        treeNode2 = new javax.swing.tree.DefaultMutableTreeNode("ViewRelatorio");
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("acessar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);
        treeNode3 = new javax.swing.tree.DefaultMutableTreeNode("criar");
        treeNode4 = new javax.swing.tree.DefaultMutableTreeNode("sim");
        treeNode3.add(treeNode4);
        treeNode2.add(treeNode3);

        treeNode1.add(treeNode2);
        jTnivel.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));

    }

    private void ativaView() {
        jTnivel.setEnabled(true);
        jBsalvar.setEnabled(true);
    }

    private void desativaView() {
        jtidusuario.setText("");
        jtnome.setText("");
        jTnivel.setEnabled(false);
        jBsalvar.setEnabled(false);
        marcaTodos();
    }

    private void permissaoUsuario() {
        if (!new NivelAcesso().getAcesso("ViewNivel", "alterar", false)) {
            jPanel1.setVisible(false);
        }

    }

}
